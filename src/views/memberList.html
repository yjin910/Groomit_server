<!DOCTYPE html>
<html lang="en">

    <head>
        <title>9room::Admin</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700i&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../public/css/admin.css">
    </head>
    <body>
        <div class="info">
            <img class="logo_groomit" src="../public/images/groomit_logo.png" alt="Groomit logo" onclick="window.location.href='/login'">&nbsp
            관리자 회원 관리
        </div>
        <!-- <button type="button" onclick="addDevice()">Add Device</button>
        <button type="button">Delete Device</button> -->
        <table id='user_table'></table>

        <footer>
            <div class="copyright">&copy 2015 - Technonia</div>
            <a href="http://technonia.cafe24.com/" class="about">About Us</a>
        </footer>
        <script>
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/memberList/getUsers'); // 메소드와 주소 설정
            xhr.onreadystatechange = function() { // 요청에 대한 콜백
                if (xhr.readyState === xhr.DONE) { // 요청이 완료되면
                    if (xhr.status === 200 || xhr.status === 201) {
                        var users = (JSON.parse(xhr.responseText))[0];
                        create_table(users);
                    } else {
                        console.error(xhr.responseText);
                    }
                }
            };
            xhr.send();
            
            function create_table(users){
                var user_table = document.getElementById('user_table');
                addRow(user_table, true, "선택", "이메일", "기기명", "방사능", "온도", "습도", "이산화탄소");

                for (i in users){
                    var email = users[i].email;
                    var uuid = users[i].deviceNum;
                    var g_val = users[i].geiger;
                    var t_val = users[i].temperature;
                    var h_val = users[i].humidity;
                    var c_val = users[i].co2;

                    addRow(user_table, false, null, email, uuid, g_val, t_val, h_val, c_val);
                }
            }

            function addCell(tr, head, val) {
                var cell = document.createElement('td');
                if (head){
                    cell = document.createElement('th');
                }

                cell.innerHTML = val;
                tr.appendChild(cell)
            }

            function generateCheckBox(email) {
                var tdTag = document.createElement('td');
                var inputTag = document.createElement('input');
                inputTag.type = 'checkbox';
                inputTag.name = 'cb_' + email;
                tdTag.appendChild(inputTag);

                return tdTag;
            }

            function addRow(user_table, head, select, email, uuid, g_val, t_val, h_val, c_val) {
                var tr = document.createElement('tr');
                if (!head) {
                    tr.appendChild(generateCheckBox(email));
                }else{
                    addCell(tr, head, select);
                }

                addCell(tr, head, email);
                addCell(tr, head, uuid);
                addCell(tr, head, g_val);
                addCell(tr, head, t_val);
                addCell(tr, head, h_val);
                addCell(tr, head, c_val);

                user_table.appendChild(tr)
            }
        </script>
    </body>
</html>