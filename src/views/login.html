<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- Javascript SDKs-->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="js/amazon-cognito-auth.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="js/config.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700i&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="login.css">

</head>

<body class="body">
    <img class="logo_groomit" src="groomit_logo.png" alt="Groomit logo" onclick="window.location.href='login.html'">
    <!-- <img class="logo_technonia" src="technonia_logo.png" alt="Technonia logo" onclick="window.location.href= 'http://technonia.cafe24.com/index.html'""> -->
    <div class="login-page">
        <form class="form">
            <h1 class="login">Login</h1>
            <input type="text" id="inputUsername" placeholder="Email" required autofocus>
            <input type="password" id="inputPassword" placeholder="Password" required>
            <button type="button" onclick="logInButton()">Login</button>
            <button type="button" onclick="window.location.href='register.html';">Sign up</button>
            <button type="button" onclick="resetPw()">Reset password</button>
        </form>
    </div>


    <script>
        function logInButton() {

            var authenticationData = {
                Username: document.getElementById("inputUsername").value,
                Password: document.getElementById("inputPassword").value,
            };

            var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

            var poolData = {
                UserPoolId: _config.cognito.userPoolId,
                ClientId: _config.cognito.clientId,
            };

            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

            var userData = {
                Username: document.getElementById("inputUsername").value,
                Pool: userPool,
            };

            var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

            cognitoUser.authenticateUser(authenticationDetails, {
                onSuccess: function(result) {
                    var accessToken = result.getAccessToken().getJwtToken();
                    console.log(accessToken);
                    window.location.href = 'main.html';
                },
                onFailure: function(err) {
                    alert(err.message || JSON.stringify(err));
                },
            });
        }

        function resetPw() {
            var userName = prompt('Enter your email', '');
            var poolData = {
                UserPoolId: _config.cognito.userPoolId, // Your user pool id here
                ClientId: _config.cognito.clientId, // Your client id here
            };

            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

            var userData = {
                Username: userName,
                Pool: userPool,
            };

            var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

            cognitoUser.forgotPassword({
                onSuccess: function(result) {
                    console.log('call result: ' + result);
                },
                onFailure: function(err) {
                    alert(err);
                    console.log(err);
                },
                inputVerificationCode() {
                    var verificationCode = prompt('Please input verification code ', '');
                    var newPassword = prompt('Enter new password ', '');
                    cognitoUser.confirmPassword(verificationCode, newPassword, this);
                }
            });
        }
    </script>
</body>

</html>